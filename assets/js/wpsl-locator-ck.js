// Location Scripts
function sendFormData(){jQuery.ajax({url:wpsl_locator.ajaxurl,type:"post",datatype:"json",data:{action:"locate",zip:jQuery("#zip").val(),locatorNonce:wpsl_locator.locatorNonce,distance:jQuery("#distance").val(),latitude:jQuery("#latitude").val(),longitude:jQuery("#longitude").val()},success:function(e){if(e.status==="error"){jQuery("#searcherror").text(e.message);jQuery("#searcherror").show();jQuery("#locatorresults").hide()}else loadLocationResults(e)}})}function geocodeZip(){var e=jQuery("#zip").val();geocoder=new google.maps.Geocoder;geocoder.geocode({address:e},function(e,t){if(t==google.maps.GeocoderStatus.OK){var n=e[0].geometry.location.lat(),r=e[0].geometry.location.lng();jQuery("#latitude").val(n);jQuery("#longitude").val(r);sendFormData()}else{jQuery("#searcherror").text("Address could not be found at this time.");jQuery("#searcherror").show();jQuery("#locatorresults").hide()}})}function loadLocationResults(e){if(e.result_count>0){var t="<h3>"+e.result_count+" locations found within "+e.distance+" miles of "+e.zip+"</h3><ul>";for(i=0;i<e.results.length;i++){t+="<li>";t=t+"<strong>"+e.results[i].title+"</strong><br />";t=t+"<em>Distance: "+e.results[i].distance+" miles</em><br />";t=t+e.results[i].address+"<br />"+e.results[i].city+", "+e.results[i].state+" "+e.results[i].zip;var n=e.results[i].phone,r=e.results[i].website;n!==""&&(t=t+"<br />Phone: "+n);r!==""&&(t=t+'<br /><a href="'+r+'" target="_blank">'+r+"</a>");t+="</li>"}t+="</ul>";jQuery("#locatorresults").removeClass("loading");jQuery("#locatorresults").html(t);jQuery("#locatormap").show();showLocationMap(e)}else{jQuery("#searcherror").text("No results found.");jQuery("#searcherror").show();jQuery("#locatorresults").hide()}}function showLocationMap(e){var t,n=new google.maps.LatLngBounds,r={mapTypeId:"roadmap",mapTypeControl:!1,zoom:8},i=[],s=new google.maps.InfoWindow,o,u;t=new google.maps.Map(document.getElementById("locatormap"),r);for(var u=0,a=e.results.length;u<a;u++){var f=e.results[u].title,l=e.results[u].latitude,c=e.results[u].longitude,h=[f,l,c];i.push(h)}for(u=0;u<i.length;u++){var p=new google.maps.LatLng(i[u][1],i[u][2]);n.extend(p);o=new google.maps.Marker({position:p,map:t,title:i[u][0]});google.maps.event.addListener(o,"click",function(e,n){return function(){s.setContent(i[n][0]);s.open(t,e)}}(o,u));t.fitBounds(n)}var d=google.maps.event.addListener(t,"bounds_changed",function(e){google.maps.event.removeListener(d)})}jQuery("#wpslsubmit").on("click",function(e){e.preventDefault();jQuery("#searcherror").hide();jQuery("#locatormap").hide();jQuery("#locatorresults").empty();jQuery("#locatorresults").show();geocodeZip()});