function sendFormData(){jQuery.ajax({url:wpsl_locator.ajaxurl,type:"post",datatype:"json",data:{action:"locate",zip:jQuery("#zip").val(),locatorNonce:wpsl_locator.locatorNonce,distance:jQuery("#distance").val(),latitude:jQuery("#latitude").val(),longitude:jQuery("#longitude").val(),unit:jQuery("#unit").val()},success:function(e){"error"===e.status?(jQuery("#searcherror").text(e.message),jQuery("#searcherror").show(),jQuery("#locatorresults").hide()):loadLocationResults(e)}})}function geocodeZip(){var e=jQuery("#zip").val();geocoder=new google.maps.Geocoder,geocoder.geocode({address:e},function(e,o){if(o==google.maps.GeocoderStatus.OK){var t=e[0].geometry.location.lat(),r=e[0].geometry.location.lng();jQuery("#latitude").val(t),jQuery("#longitude").val(r),sendFormData()}else jQuery("#searcherror").text("Address could not be found at this time."),jQuery("#searcherror").show(),jQuery("#locatorresults").hide()})}function loadLocationResults(e){if(e.result_count>0){if(1===e.result_count)var o=wpsl_locator.location;else var o=wpsl_locator.locations;var t="<h3>"+e.result_count+" "+o+" "+wpsl_locator.found_within+" "+e.distance+" "+e.unit+" of "+e.zip+"</h3><ul>";for(i=0;i<e.results.length;i++){t+="<li><strong>",t=t+'<a href="'+e.results[i].permalink+'">',t+=e.results[i].title,t+="</a></strong><br />",t=t+"<em>"+wpsl_locator.distance+": "+e.results[i].distance+" "+e.unit+"</em><br />",e.results[i].address&&(t=t+e.results[i].address+"<br />"+e.results[i].city+", "+e.results[i].state+" "+e.results[i].zip);var r=e.results[i].phone,s=e.results[i].website;r&&(t=t+"<br />"+wpsl_locator.phone+": "+r),s&&(t=t+'<br /><a href="'+s+'" target="_blank">'+s+"</a>"),t+="</li>"}t+="</ul>",jQuery("#locatorresults").removeClass("loading"),jQuery("#locatorresults").html(t),jQuery("#locatormap").show(),showLocationMap(e)}else jQuery("#searcherror").text("No results found."),jQuery("#searcherror").show(),jQuery("#locatorresults").hide()}function showLocationMap(e){var o,t,r,s=new google.maps.LatLngBounds,a={mapTypeId:"roadmap",mapTypeControl:!1,zoom:8},l=[],u=new google.maps.InfoWindow;o=new google.maps.Map(document.getElementById("locatormap"),a);for(var r=0,n=e.results.length;n>r;r++){var i=e.results[r].title,c=e.results[r].latitude,d=e.results[r].longitude,p=[i,c,d];l.push(p)}for(r=0;r<l.length;r++){var g=new google.maps.LatLng(l[r][1],l[r][2]);s.extend(g),t=new google.maps.Marker({position:g,map:o,title:l[r][0]}),google.maps.event.addListener(t,"click",function(e,t){return function(){u.setContent(l[t][0]),u.open(o,e)}}(t,r)),o.fitBounds(s)}var y=google.maps.event.addListener(o,"bounds_changed",function(){google.maps.event.removeListener(y)})}jQuery("#wpslsubmit").on("click",function(e){e.preventDefault(),jQuery("#searcherror").hide(),jQuery("#locatormap").hide(),jQuery("#locatorresults").empty(),jQuery("#locatorresults").addClass("loading"),jQuery("#locatorresults").show(),geocodeZip()});