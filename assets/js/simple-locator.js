function openInfoWindow(o){return google.maps.event.trigger(markers[o],"click"),googlemap.panTo(markers[o].getPosition()),googlemap.fitBounds(markers[o].getPosition()),googlemap.setZoom(12),!1}function wpsl_after_render(){}function wpsl_click_marker(){}function wpsl_no_results(){}function wpsl_error(){}function wpsl_success(){}function wpsl_googlemaps_response(){return googlemaps_response}var markers=[],googlemap="",active_form="",formatted_address="",googlemaps_response="",geolocation=!1;jQuery(function(o){function e(t){if(wpsl_locator.default_enabled)if("true"===wpsl_locator.default_user_center&&navigator.geolocation&&!t){var r=o(".simple-locator-form");o.each(r,function(){var t=s(o(this));o(t.results).empty().addClass("loading").show(),navigator.geolocation.getCurrentPosition(function(o){d(o,t)},function(){e(!0),o(t.results).empty().removeClass("loading").hide()})})}else a()}function t(e){o.ajax({url:wpsl_locator.ajaxurl,type:"post",datatype:"json",data:{action:"locatornonce"},success:function(t){o(".locator-nonce").remove(),o(e).find("form").append('<input type="hidden" class="locator-nonce" name="nonce" value="'+t.nonce+'" />'),r(formelements)}})}function a(){var e=wpsl_locator.default_latitude,t=wpsl_locator.default_longitude,a=o(".simple-locator-form");o.each(a,function(){formelements=s(this),formelements.map.show();{var o=new google.maps.LatLng(e,t),a={center:o,zoom:parseInt(wpsl_locator.default_zoom),mapTypeControl:!1,streetViewControl:!1,styles:wpsl_locator.mapstyles};new google.maps.Map(formelements.map[0],a)}})}function s(e){var t=".wpsl-map",a=".wpsl-results";if(o(active_form).siblings("#widget").length<1){if("."===wpsl_locator_options.mapcont.charAt(0))var t=o(e).find(wpsl_locator_options.mapcont);else var t=o(wpsl_locator_options.mapcont);if("."===wpsl_locator_options.resultscontainer.charAt(0))var a=o(e).find(wpsl_locator_options.resultscontainer);else var a=o(wpsl_locator_options.resultscontainer)}else var t=o(active_form).find(t),a=o(active_form).find(a);return formelements={parentdiv:o(e),errordiv:o(e).find(".wpsl-error"),map:t,results:a,distance:o(e).find(".distanceselect"),address:o(e).find(".address"),latitude:o(e).find(".latitude"),longitude:o(e).find(".longitude"),unit:o(e).find(".unit")}}function r(e){var t=o(e.address).val();geocoder=new google.maps.Geocoder,geocoder.geocode({address:t},function(t,a){if(a==google.maps.GeocoderStatus.OK){googlemaps_response=t;var s=t[0].geometry.location.lat(),r=t[0].geometry.location.lng();formatted_address=t[0].formatted_address,o(e.latitude).val(s),o(e.longitude).val(r),n(e)}else wpsl_error(wpsl_locator.notfounderror,active_form),o(e.errordiv).text(wpsl_locator.notfounderror).show(),o(e.results).hide()})}function n(e){o.ajax({url:wpsl_locator.ajaxurl,type:"post",datatype:"json",data:{action:"locate",address:o(e.address).val(),formatted_address:formatted_address,locatorNonce:o(".locator-nonce").val(),distance:o(e.distance).val(),latitude:o(e.latitude).val(),longitude:o(e.longitude).val(),unit:o(e.unit).val(),geolocation:geolocation},success:function(t){"error"===t.status?(wpsl_error(t.message,active_form),o(e.errordiv).text(t.message).show(),o(e.results).hide()):(wpsl_success(t.result_count,t.results,active_form),l(t,e))}})}function l(e,t){if(e.result_count>0){var a=1===e.result_count?wpsl_locator.location:wpsl_locator.locations,s="<h3>"+e.result_count+" "+a+" "+wpsl_locator.found_within+" "+e.distance+" "+e.unit+" of ";for(s+="true"===e.using_geolocation?wpsl_locator.yourlocation:e.formatted_address,s+="</h3><ul>",i=0;i<e.results.length;i++)s=s+"<li data-result="+i+">"+e.results[i].output+"</li>";s+="</ul>",o(t.results).removeClass("loading").html(s),o(t.map).show(),o(t.zip).val("").blur(),c(e,t),wpsl_after_render(active_form)}else wpsl_no_results(e.formatted_address,active_form),o(t.errordiv).text("No results found.").show(),o(t.results).hide()}function c(e,t){markers=[];var a=wpsl_locator.mapstyles,s=o(t.map)[0];if("undefined"!=typeof wpsl_locator_options)var r="show"===wpsl_locator_options.mapcontrols?!1:!0;else var r=!1;if("undefined"!=typeof wpsl_locator_options)var n=google.maps.ControlPosition[wpsl_locator_options.mapcontrolsposition];else var n="TOP_LEFT";var l,i,c,p=wpsl_locator.mappin?wpsl_locator.mappin:"",d=new google.maps.LatLngBounds,u={mapTypeId:"roadmap",mapTypeControl:!1,zoom:8,styles:a,panControl:!1,disableDefaultUI:r,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:n}},m=[],f=new google.maps.InfoWindow;l=new google.maps.Map(s,u);for(var c=0,g=e.results.length;g>c;c++){var _=e.results[c].title,v=e.results[c].latitude,w=e.results[c].longitude,h=e.results[c].permalink,y=e.results[c].id,k=[_,v,w,h,y];m.push(k)}for(c=0;c<m.length;c++){var b=new google.maps.LatLng(m[c][1],m[c][2]);d.extend(b),i=new google.maps.Marker({position:b,map:l,title:m[c][0],icon:p}),google.maps.event.addListener(i,"click",function(o,e){return function(){f.setContent("<h4>"+m[e][0]+'</h4><p><a href="'+m[e][3]+'" data-location-id="'+m[e][4]+'">'+wpsl_locator.viewlocation+"</a></p>"),f.open(l,o),wpsl_click_marker(o,e,active_form,m[e][4])}}(i,c)),markers.push(i),l.fitBounds(d);var C=google.maps.event.addListener(l,"idle",function(){e.results.length<2&&l.setZoom(13),google.maps.event.removeListener(C)})}var L=google.maps.event.addListener(l,"bounds_changed",function(){google.maps.event.removeListener(L)});googlemap=l}function p(){if("true"!==wpsl_locator.showgeobutton)return!1;if(navigator.geolocation){var e='<button class="wpsl-geo-button">'+wpsl_locator.geobuttontext+"</button>";o(".geo_button_cont").html(e)}}function d(e,t){var a=e.coords.longitude,s=e.coords.latitude;o(t.latitude).val(s),o(t.longitude).val(a),geolocation=!0,n(t)}o(document).ready(function(){e()}),o(".wpslsubmit").on("click",function(e){e.preventDefault(),geolocation=!1;var a=o(this).parents(".simple-locator-form");active_form=a;var r=s(a);o(r.errordiv).hide(),wpsl_locator.default_enabled?o(r.map).find(".gm-style").remove():o(r.map).hide(),o(r.results).empty().addClass("loading").show(),t(a,r)}),o(document).ready(function(){p()}),o(document).on("click",".wpsl-geo-button",function(e){e.preventDefault();var t=o(this).parents(".simple-locator-form");active_form=t;var a=s(t);o(a.errordiv).hide(),wpsl_locator.default_enabled?o(a.map).find(".gm-style").remove():o(a.map).hide(),o(a.results).empty().addClass("loading").show(),navigator.geolocation.getCurrentPosition(function(o){d(o,a)})})});